/** @type {import('next').NextConfig} */
const nextConfig = {
  // Next.js Static Export para Firebase Hosting
  output: 'export',
  trailingSlash: false,
  skipTrailingSlashRedirect: false,
  
  // ESLint: permitir builds aunque existan errores de lint (temporal)
  // Advertencia: Ãºsalo solo si tienes ESLint en CI u otro punto del flujo
  // para no ignorar errores permanentemente.
  eslint: {
    ignoreDuringBuilds: true,
  },
  
  // Image optimization configuration (evitar dependencias nativas como sharp)
  images: {
    domains: ['firebasestorage.googleapis.com', 'images.unsplash.com'],
    unoptimized: true
  },
  
  // Environment variables
  env: {
    NEXT_PUBLIC_APP_NAME: 'Gliter',
    NEXT_PUBLIC_APP_VERSION: '1.0.0'
  },
  
  // Security headers + Caching for static assets
  async headers() {
    return [
      // Cache busting and immutable caching for Next static assets
      {
        source: '/_next/static/:path*',
        headers: [
          { key: 'Cache-Control', value: 'public, max-age=31536000, immutable' }
        ]
      },
      // Cache immutable for common static asset extensions
      {
        source: '/:path*.(js|css|json|svg|png|jpg|jpeg|gif|webp|woff|woff2|ttf|eot)',
        headers: [
          { key: 'Cache-Control', value: 'public, max-age=31536000, immutable' }
        ]
      },
      // Security headers (apply to all routes)
      {
        source: '/(.*)',
        headers: [
          { key: 'X-Frame-Options', value: 'DENY' },
          { key: 'X-Content-Type-Options', value: 'nosniff' },
          { key: 'Referrer-Policy', value: 'strict-origin-when-cross-origin' },
          { key: 'Permissions-Policy', value: 'geolocation=(self), microphone=(), camera=()' }
        ]
      }
    ]
  },

  // Redirects para favicon
  async redirects() {
    return [
      {
        source: '/favicon.ico',
        destination: '/icon.svg',
        permanent: false
      }
    ]
  }
}

module.exports = nextConfig